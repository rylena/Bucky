<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Ducky Controller</title>
    <style>
        body { 
            font-family: Arial; 
            margin: 20px;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        textarea { 
            width: 100%; 
            height: 200px; 
            margin: 10px 0;
            font-family: monospace;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .connected { background: #d4edda; }
        .disconnected { background: #f8d7da; }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ESP32 Ducky Controller</h1>
    
    <div>
        ESP32 IP Address: 
        <input type="text" id="ip" value="192.168.1.100" placeholder="Enter ESP32 IP">
        <button onclick="checkStatus()">Check Connection</button>
    </div>
    
    <div id="status" class="status"></div>
    
    <textarea id="script" placeholder="Enter DuckyScript commands...
Example:
STRING Hello World
ENTER
DELAY 1000
CTRL ALT DELETE"></textarea>
    
    <button onclick="execute()">Run Script</button>

    <script>
        async function checkStatus() {
            const ip = document.getElementById('ip').value;
            try {
                const response = await fetch(`http://${ip}/status`);
                const status = await response.text();
                const statusDiv = document.getElementById('status');
                statusDiv.textContent = `Status: ${status}`;
                statusDiv.className = `status ${status}`;
            } catch (e) {
                document.getElementById('status').textContent = 'Error: Cannot connect to ESP32';
                document.getElementById('status').className = 'status disconnected';
            }
        }

        async function execute() {
            const ip = document.getElementById('ip').value;
            const script = document.getElementById('script').value;
            const commands = script.split('\n');
            
            for (const command of commands) {
                if (command.trim() === '') continue;
                
                try {
                    await fetch(`http://${ip}/execute`, {
                        method: 'POST',
                        body: command.trim()
                    });
                } catch (e) {
                    alert('Error executing command: ' + command);
                    break;
                }
            }
            alert('Script execution completed!');
        }

        // Check status on load
        checkStatus();
    </script>
</body>
</html>
